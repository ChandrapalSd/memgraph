# WARNING: do not run this script without defining THREADS!
# If THREADS isn't defined then this script will call 'make -j'.
# From the manpage: "If the  -j  option is given without an argument, make will not limit the number of jobs that can run simultaneously."
# That means that the whole build will be started simultaneously and IT WILL CRASH YOUR COMPUTER!

cd ../..

TIMEOUT=600 ./init
bash -c "doxygen Doxyfile >/dev/null 2>/dev/null"

cd build
cmake -DTOOLS=ON -DCMAKE_BUILD_TYPE=Release -DUSE_READLINE=OFF ..
TIMEOUT=1000 make -j$THREADS

# Create a binary package (which can then be used for Docker image).
mkdir output
cd output
cpack -D CPACK_SET_DESTDIR=ON -G TGZ --config ../CPackConfig.cmake
cpack -G DEB --config ../CPackConfig.cmake

# Create user technical documentation for community site
cd ../../docs/user_technical
./bundle_community

# Install tools, because they may be needed to run some benchmarks and tests.
cd ../../tools
./setup

cd apollo
./generate release
