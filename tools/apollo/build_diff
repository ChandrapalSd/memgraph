# WARNING: do not run this script without defining THREADS!
# If THREADS isn't defined then this script will call 'make -j'.
# From the manpage: "If the  -j  option is given without an argument, make will not limit the number of jobs that can run simultaneously."
# That means that the whole build will be started simultaneously and IT WILL CRASH YOUR COMPUTER!

cd ../../..

cp -r memgraph parent

cd memgraph

TIMEOUT=600 ./init
bash -c "doxygen Doxyfile >/dev/null 2>/dev/null"

cd build
cmake -DTEST_COVERAGE=ON ..
TIMEOUT=1000 make -j$THREADS

cd ..
mkdir build_release

cd build_release
cmake -DCMAKE_BUILD_TYPE=release ..
TIMEOUT=1000 make -j$THREADS memgraph_link_target memgraph__macro_benchmark__harness_client

cd ../../parent

git checkout HEAD~1
TIMEOUT=600 ./init

cd build
cmake -DCMAKE_BUILD_TYPE=release ..
TIMEOUT=1000 make -j$THREADS memgraph_link_target

cd ../../memgraph/tools/apollo

./generate diff
